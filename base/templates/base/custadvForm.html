{% extends "base/base.html" %}

{% block app_content %}

{% include "base/nav.html" with custadv=custadv title=title %}

<div>
  <div>
  <form role="form" method="post">{% csrf_token %}
    <div style="margin-top:0px;margin-bottom:0px;" class="form-row">
      <div class="form-group col-md-12" style="text-align:right">
          <input class="btn btn-success btn-md" type="submit" value="存檔" />
          <!--
          {% if custadv %}
            <a class="btn btn-warning btn-md" href="{% url 'base:custadvUpdate' custadv.id %}">取消</a>
          {% endif %}
          -->
          <a class="btn btn-primary btn-md" href="{% url 'base:custadvList' %}">離開</a>
      </div>
    </div>
    {{ form.non_field_errors }}
    <div>
      <div class="form-row">
        <div class="form-group col-md-3">
          {{ form.cuno.errors}}
          {{ form.cuno.label_tag}}
          {{ form.cuno }}
        </div>
        <div class="form-group col-md-9">
          {{ form.ipntfy.errors}}
          {{ form.ipntfy.label_tag}}
          {{ form.ipntfy }}
        </div>
      </div>
      <div class="form-row">
        <div class="form-group col-md-4">
          {{ form.ipntfym.errors}}
          {{ form.ipntfym.label_tag}}
          {{ form.ipntfym }}
        </div>
        <div class="form-group col-md-4">
          {{ form.ipntftl.errors}}
          {{ form.ipntftl.label_tag}}
          {{ form.ipntftl }}
        </div>
        <div class="form-group col-md-4">
          {{ form.ipntffx.errors}}
          {{ form.ipntffx.label_tag}}
          {{ form.ipntffx }}
        </div>
      </div>
      <div>
        <div class="form-group col-md-4">
          {{ form.ipmnspay.errors}}
          <label>{{ form.ipmnspay }}{{ form.ipmnspay.label }}</label>
        </div>
        <div class="form-group col-md-4">
          {{ form.ipentry.errors}}
          <label>{{ form.ipentry }}{{ form.ipentry.label }}</label>
        </div>
        <div class="form-group col-md-4">
          {{ form.iprtord.errors}}
          <label>{{ form.iprtord }}{{ form.iprtord.label }}</label>
        </div>
      </div>
      <div>
      <div class="form-group col-md-8">
          {{ form.ipntfmk.errors}}
          {{ form.ipntfmk.label_tag}}
          {{ form.ipntfmk }}
      </div>

      </div>
    </div>
  </form>
  </div>
  <div id="custqtnEdit" class="form-row">
    <table style="margin-left: 1em; width: 97.5%;" id="custqtn" class="table table-hover table-bordered table-responsive">
      <thead>
        <tr>
          <th style="display:none;width: 1%;vertical-align: middle;">#ID</th>
          <th style="width: 1%;vertical-align: middle;">No.</th>
          <th style="vertical-align: middle">ORG</th>
          <th style="vertical-align: middle">日期</th>
          <th style="vertical-align: middle">說明</th>
          <th class="text-center">
            {% if custadv %}
              <input type="hidden" id="Url" data-url="{% url 'base:custqtnNew' custadv.id %}" />
              <button onclick="newqtnForm()" class="btn btn-info btn-sm" id="newqtn">
              <span class="glyphicon glyphicon-plus"></span>&nbsp;<b>Line</b></button>
            {% endif %}
          </th>
        </tr>
      </thead>
      <tbody style="background-color:white">
          {% for custqtn in custqtns %}
            <tr>
            <td style="display:none">{{ custqtn.id }}</td>
            <td>{{ forloop.counter }}</td>
            <td>{{ custqtn.org }}</td>
            <td>{{ custqtn.qtndd|date:"Y-m-d" }}</td>
            <td>{{ custqtn.qtns }}</td>
            </tr>
          {% endfor %}
      </tbody>
    </table>
  </div>
  <div id="custqtnNew" class="form-row"></div>
</div>
<script>
    function newqtnForm() {
        var url = $("#Url").attr("data-url");
        $.get(url, {'request': 'custqtn'}, function (data, status) {
            $('#custqtnEdit').hide();
            $('#custqtnNew').html(data);
        });
    }
    
    $(document).ready(function() {
        $.ajaxSetup({
            data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
            });
        
        $('#custqtn').Tabledit({
            url: '{% url "base:custqtnTabledit" %}',
            restoreButton: false,
            hideIdentifier: true,
            columns: {
                identifier: [0, 'id'],
                editable: [[2, 'org'], [3, 'qtndd'], [4, 'qtns']]
            },
            onDraw: function () {
                // Select all inputs of second column and apply datepicker each of them
                //$('table tr td:nth-child(2) input').each(function() {
                $('table tr td:nth-child(4)').each(function () {
                    $(this).datepicker({
                        format: "yyyy-mm-dd",
                        todayBtn: "linked",
                        autoclose: true,
                        todayHighlight: true,
                    });
                });
            },
            onSuccess: function (data, textStatus, jqXHR) {
                console.log('onSuccess(data, textStatus, jqXHR)');
                console.log(data);
                console.log(textStatus);
                console.log(jqXHR);
                if (data.action == 'delete')
                 {
                  $('#'+data.id).remove();
                 }
            },
            onFail: function (jqXHR, textStatus, errorThrown) {
                console.log('onFail(jqXHR, textStatus, errorThrown)');
                console.log(jqXHR);
                console.log(textStatus);
                console.log(errorThrown);
            },
            onAlways: function () {
                console.log('onAlways()');
            },
            onAjax: function (action, serialize) {
                console.log('onAjax(action, serialize)');
                console.log(action);
                console.log(serialize);
            }
        });

        $('#custqtn thead tr th:last-child').remove();
        




        

        // $('#newqtn1').click(function() {
        //     var table = $('#custqtn');
        //     var body = $('#custqtn tbody');
        //     var nextId = body.find('tr').length + 1;
        //     body.prepend($('' + nextId + ''));
        //     table.Tabledit('update');
        // });

        // $("#newqtn2").click(function(e){
        //     var table = $(this).attr('for-table');  //get the target table selector
        //     var $tr = $(table + ">tbody>tr:last-child").clone(true, true);  //clone the last row
        //     var nextID = parseInt($tr.find("input.tabledit-identifier").val()) + 1; //get the ID and add one.
        //     $tr.find("input.tabledit-identifier").val(nextID);  //set the row identifier
        //     $tr.find("span.tabledit-identifier").text(nextID);  //set the row identifier
        //     $(table + ">tbody").append($tr);    //add the row to the table
        //     $tr.find(".tabledit-edit-button").click();  //pretend to click the edit button
        //     $tr.find("input:not([type=hidden]), select").val("");   //wipe out the inputs.
        // });

    })
  
</script>

{% endblock app_content%}