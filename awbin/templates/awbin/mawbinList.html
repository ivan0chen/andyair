
{% extends "awbin/base.html" %}
{% block extra_style%}

  <!--<link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">-->
  <style type="text/css">
      td.details-control {
          background: url('{% static "main/images/details_open.png" %}') no-repeat center center;
          cursor: pointer;
      }
      tr.shown td.details-control {
          background: url('{% static "main/images/details_close.png" %}') no-repeat center center;
      }
  </style>
{% endblock %}
{% block extra_js%}
    <!--<script src="https://code.jquery.com/jquery-3.3.1.js"></script>-->
    <!--<script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>-->
{% endblock %}

{% block app_content %}
{% include "awbin/nav.html" with title=title %}
{% include 'main/messages.html' %}
<div>
  <table class="table table-striped table-bordered table-responsive table-condensed" id="mawbinList">
    <thead>
      <tr>
        <th></th>
        <th style="vertical-align: middle;">主提單</th>
        <th style="vertical-align: middle">總LOT號</th>
        <th style="vertical-align: middle">日期</th>
        <th style="vertical-align: middle">POD</th>
        <th style="vertical-align: middle">FAX</th>
        <th id="newMawbin" class="text-center">
          <a href="{% url 'awbin:mawbinCreate' %}" class="btn btn-block btn-info btn-sm active">
            <span class="glyphicon glyphicon-plus"></span><b>&nbsp;New</b></a>
        </th>
      </tr>
    </thead>
    <tbody style="background-color:white">
      {% for mawbin in mawbins %}
        <tr>
          <td data-form="{% url 'awbin:hawbinList' mawbin.id %}"></td>
          <td style="vertical-align: middle;">{{ mawbin.mawb }}</td>
          <td style="vertical-align: middle;">{{ mawbin.seqnr }}</td>
          <td style="vertical-align: middle;">{{ mawbin.prsdd }}</td>
          <td style="vertical-align: middle;">{{ mawbin.nrhbhold }}</td>
          <td style="vertical-align: middle;">{{ mawbin.podfax }}</td>
          <td style="text-align: center;white-space: nowrap; width: 12%;">
            <div class="tabledit-toolbar btn-toolbar">
              <div class="btn-group btn-group-sm" style="float: none;">
                <a href="{% url 'awbin:mawbinView' mawbin.id %}" class="tabledit-edit-button btn btn-sm btn-default "><span class="glyphicon glyphicon-eye-open"></span></a>
                <a href="{% url 'awbin:mawbinUpdate' mawbin.id %}" class="tabledit-edit-button btn btn-sm btn-default "><span class="glyphicon glyphicon-pencil"></span></a>
                <a href="{% url 'awbin:mawbinDelete' mawbin.id %}" class="tabledit-delete-button btn btn-sm btn-default "><span class="glyphicon glyphicon-trash"></span></a>
              </div>
            </div>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script type="text/javascript">
    // function sub_DataTable(vtask_id, table_id) {
    //     var subtable = $('table#'+table_id).DataTable({
    //         "ajax": {
    //             "type": "GET",
    //             "url": "/"
    //         }
    //     });
    // }
    //
   function format ( table_id ) {
      // `d` is the original data object for the row
      // return '<table id="'+table_id+'" class="display" border="0" style="padding-left:50px; width:100%;">'+
      // '<thead>'+
      // '<th style="background-color:white;">&emsp;</th>'+
      // '<th>HAWB#</th>'+
      // '<th>HawbLot#</th>'+
      // '<th>Belong</th>'+
      // '<th>併分單筆數</th>'+
      // '<th>件數</th>'+
      // '<th>分號</th>'+
      // '        <th id="newMawbin" class="text-center">\n' +
      //     '          <a href="#" class="btn btn-block btn-info btn-sm active">\n' +
      //     '            <span class="glyphicon glyphicon-plus"></span><b>&nbsp;New Hawb</b></a>\n' +
      //     '        </th>'+
      // '</thead>'+
      // '</table>';
       return '<div id="'+table_id+'"></div>'
   }

    $(document).ready(function(){
        var table = $('#mawbinList').DataTable({
            "searching": true,
            "ordering": true,
            "paging": true,
            "order": [[ 1, "asc" ]],
            "columnDefs": [
                {
                    "targets": 0,
                    "className": 'details-control',
                    "orderable": false,
                    "data": null,
                    "defaultContent": ''
                },
                {
                    "targets": 6,
                    "searchable": false,
                    "orderable": false
                },
            ]
        });

        $('#newMawbin').removeClass('sorting_disabled').removeAttr('aria-label').css('padding','8px');
 
        // Add event listener for opening and closing details
        $('#mawbinList tbody').on('click', 'td.details-control', function () {
            var tr = $(this).closest('tr');
            var row = table.row( tr );

 
         
            if ( row.child.isShown() ) {
                // This row is already open - close it
                row.child.hide();
                tr.removeClass('shown');
            }
            else {
                // Open this row
                var virtual_task_id = row.data()[1];
                var subtable_id = "subtable-"+virtual_task_id;
                event.preventDefault(); // prevent navigation
                var url = $(this).data("form");
                
                row.child(format(subtable_id)).show(); /* HERE I format the new table */
                $('#'+subtable_id).load(url, function() { // load the url into the modal
                    // $(this).modal('show'); // display the modal on url load
                    alert(url);
    
                });
                
                tr.addClass('shown');
                // sub_DataTable(virtual_task_id, subtable_id); /*HERE I was expecting to load data*/
            }
            return false; // prevent the click propagation
        });
    });
    
</script>

{% endblock app_content %}